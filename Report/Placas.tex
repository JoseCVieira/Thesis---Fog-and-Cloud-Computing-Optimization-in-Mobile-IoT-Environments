\chapter{Implementação da U3C}
Este capítulo apresenta e descreve o desenvolvimento das placas de circuito impresso, passando pelas normas e regras a respeitar, as especificações técnicas e a disposição dos componentes/módulos nas placas. Posteriormente são apresentadas tanto as placa de RF como a placa principal/\textit{motherboard} da U3C. Por fim é mostrado e descrito o aspeto físico final da U3C.
\section{Placas de circuito impresso}
Na conceção de placa de circuito impresso deve haver diversos cuidados a ter em conta para evitar erros que provocam o mau funcionamento, sem que existam necessariamente erros nas ligações. Deste modo há que respeitar regras de implementação sendo este um processo muito minucioso e de elevada complexidade.
\subsection{Normas práticas gerais}
As regras de boas práticas no desenho de uma PCI foram sendo adquiridas ao longo do projeto. Apresenta-se de seguida uma listagem de algumas regras a cumprir para uma boa implementação e consequente bom funcionamento.
\begin{itemize}[topsep=6pt,itemsep=-1ex,partopsep=1ex,parsep=2ex]
	\item As pistas devem ter o menor comprimento possível para minimizar os elementos parasitas indesejados. Para além disso caso a pista seja suficientemente grande, esta fará com que a fase do sinal recebido seja alterada, ou ainda poderá atuar como uma antena, radiando parte da potência do sinal;
	\item Evitar ao máximo pistas com ângulos retos. Quaisquer curvas representam uma resistência à passagem da corrente, isto significa que o seu valor resistivo aumenta. Particularmente, nos ângulos retos esta resistência é mais elevada. Sempre que necessárias devem ser implementadas curvas mais suaves;
	\item A utilização de um bom plano de massa é indispensável para minimizar problemas de compatibilidade eletromagnética (EMC). Para isso plano deve ocupar boa parte da área da PCI (tanto quanto possível), onde é fundamental que os elementos parasitas entre quaisquer dois pontos sejam os menores possíveis, sendo, para isso, boa prática a implementação de várias vias para interligar os planos de massa das várias camadas da PCI. De igual forma, é boa prática, evitar cortes no plano de massa, especialmente quando este está próximo de linhas de alto débito, que fará com que o retorno da linha (fluxo de corrente) seja sentido de forma mais intensa nos planos agora interrompidos, o que pudera acartar problemas para o restante circuito. Na prática, uma forma rápida de testar a qualidade do plano é verificar a resistência existente entre dois extremos opostos da placa;
	\item A implementação de condensadores de desacoplamento é uma regra importante. Estes devem ser colocados em fontes de tensão e nos pinos dos circuitos integrados (o mais próximo possível) onde é feita a sua alimentação, de forma a filtrar as componentes de alta frequência destas linhas;
	\item Um outro cuidado que se deve ter é o posicionamento entre as várias bobinas. Caso duas bobinas fiquem lado a lado a uma distância relativamente pequena, os seus campos magnéticos irão ser afetados um pelo outro. Para minimizar este efeito, os ângulos utilizados entre bobinas devem ser de $0~^{\circ}$ ou $90~^{\circ}$;
	\item Evitar a concentração de vias num local para não fragilizar a PCI. Também não se devem colocar vias demasiado próximas dos \textit{pads} dos componentes;
	\item Sempre que possível, devem ser implementados os componentes que o fabricante recomenda. Para isso é boa prática consultar os \textit{applications notes}, quando disponibilizados, dos CI em questão, onde, normalmente, são indicados as referências destes componentes. Quando não é possível a sua implementação, por descontinuação do produto ou falta de \textit{stock}, devem ser procurados componentes em que os seus parâmetros (fabricante, valor, geometria/encapsulamento, dielétrico) sejam os mais próximos possíveis do ideal (normalmente os \textit{sites} providenciam esta funcionalidade). De igual forma os \textit{applications notes} devem ser consultados para seguir as recomendações de implementação dos CI em PCI. Por exemplo, em componentes que necessitam de grande dissipação de calor ou em componentes de radio frequência, há recomendações indispensáveis no desenho da PCI;
	\item Os componentes devem ser uniformemente distribuídos pela PCI, permitindo que estes consigam dissipar o calor produzido. Em componentes que necessitam de uma dissipação térmica maior, deve deixar-se uma área de dissipação superior;
	\item Devem ser escolhidos componentes de montagem de superfície, caso a PCI seja comercializada. Os componentes em \textit{surface mounting device} (SMD) facilitam a montagem das placas com recurso a maquinaria especializada. Se possível, todos os componentes devem estar na mesma face da PCI para reduzir custos de montagem/assemblagem;
	\item Os componentes devem ser agrupados de acordo com a sua funcionalidade, tais como, fonte de alimentação, secções digitais, circuitos de baixa ou alta velocidade, entre outros;
	\item Colocar os componentes alinhados horizontalmente ou verticalmente uns com os outros, fazendo com que exista alguma coerência na visualização dos componentes;
	\item Posicionar os componentes de acesso comum nos locais mais acessíveis, facilitando assim a utilização destes por parte do utilizador/instalador.
\end{itemize}
\subsection{Tipo de PCI e regras de projeto}
As regras de projeto do fabricante das PCIs fazem referência ao número e espessura de camadas de metal (usualmente cobre) e de dielétrico da PCI, à largura mínima das pistas, ao diâmetro interno e externo das vias, à distância mínima entre vias e/ou pistas, entre outras regras. A verificação (\textit{design rule check} - DRC) e o cumprimento de todas estas regras são fundamentais para que o fabricante possa produzir as PCIs projetadas.\\[6pt]
As placas de circuito impresso utilizadas na implementação da U3C contêm apenas um dielétrico do tipo FR4, duas camadas de cobre, uma na face inferior e outra na superior, sendo que os componentes são colocados todos na face superior da PCI. Esta configuração permite obter um baixo custo na produção e montagem da mesma.\\[6pt]
Em termos elétricos, e sobretudo para as ligações referentes a alimentações e a sinais de baixa frequência, a largura mínima das pistas tem de ser definida de acordo com a corrente que as atravessa. Deste modo, todas as pistas onde a densidade de corrente é reduzida foram desenhadas com uma largura de 12 mil (0.3 mm) ou de 14 mil (0.35 mm). Nas linhas de alimentação, onde a corrente pode ser elevada, a largura mínima é de 30 mil (0.76 mm). A distância entre pistas é de 10 mil (0.25 mm) o que permite tensões entre pistas de 100 V, o que no caso da U3C nunca se verifica. Estes dados foram obtidos a partir do \textit{software} ``Saturn PCB Design''[\ref{saturn}].\\[6pt]
Por fim, o diâmetro das vias foi adaptado para cada largura de pista e verificado a partir do \textit{software} a passagem de corrente permitida. O espaçamento entre vias é igual ao das pistas.
\subsection{Planos de terra}
Estes planos são feitos de forma automática no \textit{software}, apenas sendo necessário identificar a área necessária e o espaçamento deixando entre o plano e as outras estruturas físicas da mesma camada, tais como vias, pads, pistas, entre outros. Após a realização dos planos existe a necessidade de fazer um rastreamento de toda a placa de circuito impresso e verificar as ligações à massa de todos os componentes.
\subsection{Legendas}
Para facilitar a montagem e futuras manutenções/reparações da U3C é necessário que todos os componentes estejam identificados nas PCIs. A legenda dos componentes deve seguir o mesmo formato para o mesmo tipo de componente, ou seja, se uma resistência for identificada com a letra 'R' seguido do seu número, todas as restantes resistências devem iniciar com a mesma letra.
\section{Estrutura física e placa principal da U3C}
A unidade central é um equipamento que deve ser compacta, sendo comum a sua instalação em locais pouco espaçosos. Desta forma, procurou-se encontrar caixas plásticas em vários fornecedores considerando alguns critérios necessários, tais como: o seu tamanho exterior e o número de ligações externas possíveis de efetuar. Optando-se no fim pelo modelo RT-204 da Altinkaya. A caixa em questão tem permite a inserção do número de entradas e saídas necessárias com a vantagem de estas ficaram posicionadas cada uma numa das suas extremidades, reduzindo a probabilidade de erros de ligação, tem uma janela amovível na parte superior que permite uma fácil visualização dos estados da unidade central, assim como tornar a configuração mais acessível. Permite ainda que seja instalada dentro de um quadro elétrico, pois contém um encaixe para calhas DIN e, acima de tudo, tem um formato compacto.\\[6pt]
O posicionamento dos componentes na PCI foi pensado para a otimização de espaço, visto que se pretendia incorporar toda a unidade central dentro da caixa. Apesar disso, a organização interna foi realizada também considerando aspetos de dissipação térmica e de interferências eletromagnéticas entre módulos distintos da U3C. A partir das dimensões da caixa escolhida, determinou-se o tamanho máximo que a PCI poderia ter. Os primeiros elementos a serem posicionados na PCI foram os conetores para ligação externa pois, como já foi referido, a caixa já tem uma furação própria para os mesmos.\\[6pt]
Após a realização do diagrama esquemático final da U3C, e estando as dimensões da PCI definidas, posicionaram-se os componentes para que os de maior importância para o utilizador/instalador estivessem visíveis e acessíveis, tendo os restantes sido colocados em locais de menor acessibilidade. Na figura 4.1 encontra-se identificado a disposição dos módulos na PCI final. Na organização e posicionamento dos componentes e módulos da U3C houve vários critérios de estrutura que foram respeitados, nomeadamente: a colocação do módulo RF na lateral direita da PCI e numa posição vertical (perpendicular com a placa principal), o que permitiu a colocação de um conector SMA para o exterior para que se possa ligar uma antena externa. Este posicionamento permitiu que o módulo RF ficasse suficientemente afastado da fonte comutada minimizando interferências da mesma no módulo. Além do mais, o módulo RF tem todos os seus componentes expostos na face lateral virada para o exterior da U3C, tendo este um plano de massa na outra face, o que reduz significativamente as interferências vindas de outros módulos que possam ser problemáticos. As entradas e saídas externas, e seus periféricos, foram posicionados nas extremidades correspondentes, as interfaces de configuração e programação foram colocadas no centro da caixa, possibilitando desta forma um fácil acesso. O módulo GSM, tendo a necessidade de ser removido para a inserção do cartão SIM, foi colocado também no centro da caixa, a fácil aplicação do mesmo.\\[6pt]
Estando o módulo GSM suspenso em duas réguas de ligações, oferece uma área inferior que é suficientemente espaçoso para a colocação do microcontrolador e seus periféricos.
Os componentes da PCI ficaram agrupados por módulos. Na figura \ref{fig:modulos} encontra-se identificado a disposição dos módulos na PCI final.\\[6pt]
Uma vantagem do \textit{software} utilizado é permitir a visualização em três dimensões. Desta forma consegue-se ter uma perceção da PCI final antes da sua fabricação. Como muitos dos componentes tiveram de ser desenhados, adicionalmente efetuou-se um esboço em tridimensional (3D) para obter uma melhor perceção. O modelo 3D pode ser visto na figura \ref{fig:3d}, e em anexo [\ref{PCB3d}] outras vistas do modelo.
\begin{figure}[H]
	\centering
	\includegraphics[clip, trim=5.0cm 7cm 5cm 7cm, width=0.4\linewidth]{Figuras/Desenvolvimento/modulos}
	\caption{Disposição dos módulos na PCI.}
	\label{fig:modulos}
\end{figure}
\begin{figure}[H]
	\centering
	\includegraphics[clip, trim=8cm 5cm 7cm 5cm, width=0.5\linewidth]{Figuras/Desenvolvimento/3d}
	\caption{Modelo 3D do interior da U3C.}
	\label{fig:3d}
\end{figure}

\section{Módulo de RF}
\subsection{Antena integrada}
Como referido no capítulo do desenvolvimento da U3C, foram estudadas várias antenas que operam nos 433 MHz que se encontram em \textit{papers} e em \textit{application notes}. Após a análise sucinta e a escolha de quais testar, realizaram-se um conjunto de placas de circuito impresso com cada uma dessas antenas, em que de seguida foram realizados testes aos seus desempenhos para a frequência desejada.\\[6pt]
Tendo em conta que este desenvolvimento foi um objetivo extra deste projeto de licenciatura, apenas foi possível realizar a adaptação de impedância das antenas através de cartas de Smith (Smith \textit{chart}) e medir o parâmetro S11 das antenas, não havendo o tempo necessário para a realização de outro tipo medições como é o caso da elaboração de diagramas de radiação.\\[6pt]
Os diagramas de radiação, são representações gráficas que descrevem as propriedades espaciais de radiação de uma antena, em que para cada ângulo num sistema de coordenadas esférico, é mostrado o ganho dessa antena em relação a um radiador isotópico, valor esse apresentado em dBi. Assim este é um parâmetro bastante importante no estudo das antenas.\\[6pt]
No entanto existem outros parâmetros de elevada relevância a nível do desempenho de uma antena, que são o parâmetro S11 da antena e a sua adaptação. O parâmetro S11 é uma medida que permite em cada frequência conhecer o seu coeficiente de reflexão, isto é, a relação entre a potência do sinal enviado e o sinal que é refletido (e.g, no modo de receção, corresponde à potência do sinal radiado pela antena comparativamente ao sinal que é recebido por esta). A adaptação, tal como referido, é testada na cartas de Smith, uma representação gráfica onde para cada frequência é apresentada a sua impedância. Estes dois parâmetros na verdade são consequência um do outro, visto que a partir de um se consegue calcular o outro.\\[6pt]
A calibração do instrumento de medida, \textit{vector network analyzers} (VNA) é um passo importante nestas medições. Para a sua realização é necessário recorrer a \textit{kits standard} em que através a bibliotecas o VNA conheça os seus parâmetros. Os \textit{kits} que são ligados ao seu porto de medida, são compostos por 3 elementos: o curto circuito, o circuito aberto e a carga de 50 $\Omega$ (neste caso). Estes são introduzidos no porto e medidos individualmente, assim, através de cálculos, é possível eliminar o efeito que o cabo causa na medição dos parâmetros da antena (e.g., como acontece nas balanças digitais para eliminar o peso de um vidro de relógio). Assim o VNA consegue definir valores normalizados da impedância da antena, sendo a '0' correspondente ao curto circuto, o '1' ao valor de impedância de 50 $\Omega$ e o '$\infty$' ao circuito aberto. Como o circuito de adaptação do módulo RF está dimensionado para os 50 $\Omega$, a adaptação da antena também terá de ter este valor, para que exista a máxima transferência de potência entre os dois, ou seja, idealmente, o valor de impedância dos dois estaria no valor '1' para a frequência de 433 MHz.\\[6pt]
No processo das medidas efetuadas, foram selecionadas as antenas que mais se aproximavam da frequência pretendida e com uma largura de banda razoável para que independentemente dos fatores adversos a que a antena final esteja sujeita, os 433 MHz estejam sempre dentro da sua gama de funcionamento, tendo também em conta as dimensões desejadas para a antena final (a área que ocupada). Nas \textit{application notes} [\ref{paperantena1}] - [\ref{appnoteantena2}] foram retiradas as medidas que dizem respeito ao comprimento total (16.4 cm para uma frequência de 434 MHz) e à largura da pista (3 mm, que por razões de espaço foi reduzido para 1 mm) da antena que foram utilizadas nestes desenvolvimentos. Na figura \ref{fig:antenapcb} encontra-se representada a antena final desenvolvida para a implementação no módulo RF. As restantes antenas de teste encontram-se em anexo [\ref{antenasanexo}].\\[6pt]
A antena apresentada é do tipo meander de dupla face, ou seja, utiliza a arquitetura vulgar de uma antena meander, contudo para minimizar o espaço ocupado são utilizadas duas camadas na PCI, assemelhando-se a uma espiral. Nos testes efetuados foram recolhidos os parâmetros s11 da antena e a carta de \textit{Smith} para o caso inicial (sem adaptação), figura \ref{fig:antena17naoadaptada}, e depois da adaptação, figura \ref{fig:antena17adaptada}.

\begin{figure}[H]
	\centering
	\begin{subfigure}{.5\textwidth}
		\centering
		\includegraphics[clip, width=0.7\linewidth]{Figuras/Desenvolvimento/Ant17top}
		\captionsetup{labelformat=empty}
		\caption{(a) Top layer.}
	\end{subfigure}%
	\begin{subfigure}{.5\textwidth}
		\centering
		\includegraphics[clip, width=0.7\linewidth]{Figuras/Desenvolvimento/Ant17bott}
		\captionsetup{labelformat=empty}
		\caption{(b) Bottom layer.}
	\end{subfigure}
	\caption{Antena desenvolvida para implementação no módulo RF.}
	\label{fig:antenapcb}
\end{figure}
\begin{figure}[H]
	\centering
	\begin{subfigure}{.5\textwidth}
		\centering
		\includegraphics[clip, trim=1.7cm 6.2cm 1.7cm 8.2cm, width=1\linewidth]{Figuras/Desenvolvimento/set17}
		\captionsetup{labelformat=empty}
		\caption{(a) Parâmetro S11.}
	\end{subfigure}%
	\begin{subfigure}{.5\textwidth}
		\centering
		\includegraphics[clip, trim=1.7cm 6.2cm 1.7cm 8.2cm, width=1\linewidth]{Figuras/Desenvolvimento/smithnaoadaptada}
		\captionsetup{labelformat=empty}
		\caption{(b) Carta de Smith.}
	\end{subfigure}
	\caption{Parâmetros da antena integrada sem adaptação.}
	\label{fig:antena17naoadaptada}
\end{figure}
\begin{figure}[H]
	\centering
	\begin{subfigure}{.5\textwidth}
		\centering
		\includegraphics[clip, trim=1.7cm 6.2cm 1.7cm 8.2cm, width=1\linewidth]{Figuras/Desenvolvimento/set17Adapt}
		\captionsetup{labelformat=empty}
		\caption{(a) Parâmetro S11.}
	\end{subfigure}%
	\begin{subfigure}{.5\textwidth}
		\centering
		\includegraphics[clip, trim=1.7cm 6.2cm 1.7cm 8.2cm, width=1\linewidth]{Figuras/Desenvolvimento/smithadaptada}
		\captionsetup{labelformat=empty}
		\caption{(b) Carta de Smith.}
	\end{subfigure}
	\caption{Parâmetros da antena integrada com adaptação.}
	\label{fig:antena17adaptada}
\end{figure}
\subsection{PCI}
Na elaboração da PCI do módulo RF, foram tidos em conta os cuidados mencionados na secção das placas de circuito impresso. Houve ainda um cuidado redobrado na elaboração do circuito da linha de sinal RF antes da sua desmodulação (no circuito de adaptação da linha de 50 $\Omega$) devido à máxima transferência de potência, para que as perdas de sinal sejam as mínimas possíveis e também na linha de dados desde o módulo RF ao microcontrolador para que os retornos desta linha não se fizessem sentir de forma acentuada. O desenvolvimento do módulo RF resultou na PCI apresentada na figura \ref{fig:rf}.
\section{Aspeto final}
A unidade central terá um aspeto identico ao representado na figura \ref{fig:aspetoFinal}, onde se podem observar o posicionamento dos módulos de comunicação, as ligações externas, e a caixa descrita anteriormente.
\section{Sumário}
O presente capítulo abordou todo o processo de desenvolvimento e implementação da unidade central. Neste foram apresentadas as especificações, as normas e as características que dizem respeito ao desenho das placas de circuito impresso. Foi ainda abordado o desenvolvimento da antena em PCB e apresentados os seus parâmetros. Por fim, foi apresentada uma ilustração que demonstra o aspeto final da unidade central de controlo e comando.
\begin{figure}[H]
	\centering
	\begin{subfigure}{.5\textwidth}
		\centering
		\includegraphics[clip, width=1\linewidth]{Figuras/Desenvolvimento/rfcortop}
		\captionsetup{labelformat=empty}
		\caption{(a) Top layer.}
	\end{subfigure}%
	\begin{subfigure}{.5\textwidth}
		\centering
		\includegraphics[clip, width=1\linewidth]{Figuras/Desenvolvimento/rfcorbott}
		\captionsetup{labelformat=empty}
		\caption{(b) Botton layer.}
	\end{subfigure}
	\caption{Implementação do módulo RF em PCI.}
	\label{fig:rf}
\end{figure}
\begin{figure}[H]
	\centering
	\includegraphics[clip, width=0.78\linewidth]{Figuras/Desenvolvimento/aspetoFinal}
	\caption{Aspeto final da unidade central.}
	\label{fig:aspetoFinal}
\end{figure}
\vfill\pagebreak\thispagestyle{plain}